<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>音效按钮</title>
    <script>
        // 预加载 electron
        const { ipcRenderer } = require('electron');
        const path = require('path');

        // 初始化全局变量
        window.currentAudio = null;
        window.selectedAudioOutput = 'default';

        // 音频设备初始化函数
        async function initAudioOutputs() {
            const audioSelect = document.getElementById('audioOutput');
            if (!audioSelect) {
                console.error('Audio select element not found');
                return;
            }

            try {
                // 先设置默认选项
                audioSelect.innerHTML = '<option value="default">系统默认输出</option>';

                // 请求音频权限并获取设备列表
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());

                const devices = await navigator.mediaDevices.enumerateDevices();
                console.log('Found audio devices:', devices);

                // 过滤并添加音频输出设备
                const outputs = devices.filter(device => device.kind === 'audiooutput');
                outputs.forEach(device => {
                    if (device.deviceId !== 'default' && device.deviceId !== 'communications') {
                        const option = document.createElement('option');
                        option.value = device.deviceId;
                        option.text = device.label || `音频设备 ${device.deviceId.slice(0, 5)}`;
                        audioSelect.appendChild(option);
                    }
                });

                // 设置设备切换事件
                audioSelect.onchange = async (e) => {
                    const deviceId = e.target.value;
                    window.selectedAudioOutput = deviceId;
                    
                    if (window.currentAudio && window.currentAudio.setSinkId) {
                        try {
                            await window.currentAudio.setSinkId(deviceId);
                            showNotification('已切换音频输出设备', 'success');
                        } catch (err) {
                            console.error('Error switching device:', err);
                            showNotification('切换设备失败', 'error');
                        }
                    }
                };

            } catch (err) {
                console.error('Error initializing audio devices:', err);
                showNotification('无法访问音频设备', 'error');
            }
        }

        // 主要的初始化函数
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('Initializing...');
                
                // 初始化音频设备
                await initAudioOutputs();
                
                // 注册快捷键
                await registerAllHotkeys();
                
                // 初始化默认分类 - 修改这部分代码
                const defaultTab = document.querySelector('.category-tabs .tab-item');
                if (defaultTab) {
                    defaultTab.click();
                }
                
                // 初始化窗口控制
                const closeButton = document.querySelector('.close-button');
                if (closeButton) {
                    closeButton.addEventListener('click', () => {
                        ipcRenderer.send('close-window');
                    });
                }

                const minButton = document.querySelector('.min-button');
                if (minButton) {
                    minButton.addEventListener('click', () => {
                        ipcRenderer.send('minimize-window');
                    });
                }

                console.log('Initialization complete');
            } catch (error) {
                console.error('Error during initialization:', error);
            }
        });

        // 1. 首先定义通知系统函数（放在最前面）
        function showNotification(message, type = 'info', duration = 2000) {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            requestAnimationFrame(() => {
                notification.classList.add('show');
            });
            
            setTimeout(() => {
                notification.classList.add('hide');
                notification.addEventListener('animationend', () => {
                    notification.remove();
                });
            }, duration);
        }

        // 首先定义所有需要的函数
        function createButton(category, index) {
            const button = document.createElement('button');
            button.className = 'sound-button';
            // 生成真正唯一的按钮 ID
            const uniqueId = `${category}-button-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            button.id = uniqueId;
            button.setAttribute('data-category', category);
            
            // 创建文本容器
            const textSpan = document.createElement('span');
            textSpan.textContent = ''; // 初始为空
            button.appendChild(textSpan);
            
            // 设置拖放事件
            button.ondragover = (e) => {
                e.preventDefault();
                button.classList.add('dragover');
            };

            button.ondragleave = (e) => {
                e.preventDefault();
                button.classList.remove('dragover');
            };

            button.ondrop = async (e) => {
                e.preventDefault();
                button.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && (file.type.startsWith('audio/') || file.name.endsWith('.mp3'))) {
                    try {
                        // 获取应用程序根目录路径
                        const appPath = await ipcRenderer.invoke('get-app-path');
                        // 创建音频文件存储目录
                        const audioDir = path.join(appPath, 'audio');
                        await ipcRenderer.invoke('ensure-dir', audioDir);
                        
                        // 生成唯一的文件名
                        const uniqueFileName = `${Date.now()}-${file.name}`;
                        const targetPath = path.join(audioDir, uniqueFileName);
                        
                        // 复制文件到目标路径
                        await ipcRenderer.invoke('copy-file', file.path, targetPath);
                        
                        textSpan.textContent = file.name.replace('.mp3', '');
                        button.audioData = {
                            path: targetPath, // 使用新的文件路径
                            name: file.name.replace('.mp3', '')
                        };
                        
                        const audio = new Audio(targetPath);
                        button.audioData.audio = audio;
                        setupAudioEvents(button, audio);
                        button.classList.add('has-audio');
                        
                        await saveConfig();
                        showNotification('音效添加成功！', 'success');
                        
                    } catch (err) {
                        console.error('Audio setup error:', err);
                        showNotification('音效添加失败，请重试', 'error');
                    }
                } else {
                    showNotification('请拖放音频文件', 'info');
                }
            };
            
            // 添加右键菜单事件
            button.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                
                // 移除已存在的菜单
                const existingMenu = document.querySelector('.context-menu');
                if (existingMenu) {
                    existingMenu.remove();
                }

                // 创建菜单
                const menu = document.createElement('div');
                menu.className = 'context-menu';
                
                // 创建菜单项
                const menuItems = [
                    {
                        text: '设置快捷键',
                        icon: '⌨️',
                        onClick: () => {
                            showHotkeyDialog(button);
                            menu.remove();
                        }
                    },
                    {
                        text: '清除快捷键',
                        icon: '❌',
                        onClick: () => {
                            removeHotkey(button);
                            menu.remove();
                        }
                    },
                    {
                        text: '删除音效',
                        icon: '🔇',
                        onClick: () => {
                            if (button.audioData) {
                                button.audioData = null;
                                button.querySelector('span').textContent = '';
                                button.classList.remove('has-audio');
                                saveConfig();
                                showNotification('音效已删除', 'success');
                            }
                            menu.remove();
                        }
                    },
                    {
                        text: '删除按钮',
                        icon: '🗑️',
                        onClick: async () => {
                            button.remove();
                            await saveConfig();
                            showNotification('按钮已删除', 'info');
                            menu.remove();
                        }
                    },
                    {
                        text: '音乐剪辑',
                        icon: '✂️',
                        onClick: () => {
                            showNotification('音乐剪辑功能开发中...', 'info');
                            menu.remove();
                        }
                    },
                    {
                        text: '音乐加速',
                        icon: '⏩',
                        onClick: () => {
                            showNotification('音乐加速功能开发中...', 'info');
                            menu.remove();
                        }
                    }
                ];

                // 添加菜单项到菜单
                menuItems.forEach(item => {
                    const menuItem = document.createElement('div');
                    menuItem.className = 'context-menu-item';
                    menuItem.innerHTML = `<span class="menu-icon">${item.icon}</span>${item.text}`;
                    menuItem.onclick = item.onClick;
                    menu.appendChild(menuItem);
                });

                // 调整菜单位置
                menu.style.left = `${e.clientX}px`;
                menu.style.top = `${e.clientY}px`;

                // 添加到文档
                document.body.appendChild(menu);

                // 点击其他地方关闭菜单
                const closeMenu = (e) => {
                    if (!menu.contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                };
                
                setTimeout(() => {
                    document.addEventListener('click', closeMenu);
                }, 0);
            });

            return button;
        }

        // 添加右键菜单函数
        function showButtonContextMenu(e, button) {
            e.preventDefault();
            
            // 移除已存在的菜单
            const existingMenu = document.querySelector('.context-menu');
            if (existingMenu) {
                existingMenu.remove();
            }

            // 创建菜单
            const menu = document.createElement('div');
            menu.className = 'context-menu';
            
            // 创建菜单项
            const menuItems = [
                {
                    text: '设置快捷键',
                    icon: '⌨️',
                    onClick: () => {
                        showHotkeyDialog(button);
                        menu.remove();
                    }
                },
                {
                    text: '清除快捷键',
                    icon: '❌',
                    onClick: () => {
                        removeHotkey(button);
                        menu.remove();
                    }
                },
                {
                    text: '删除音效',
                    icon: '🔇',
                    onClick: () => {
                        if (button.audioData) {
                            button.audioData = null;
                            button.querySelector('span').textContent = '';
                            button.classList.remove('has-audio');
                            saveConfig();
                            showNotification('音效已删除', 'success');
                        }
                        menu.remove();
                    }
                },
                {
                    text: '删除按钮',
                    icon: '🗑️',
                    onClick: async () => {
                        button.remove();
                        await saveConfig();
                        showNotification('按钮已删除', 'info');
                        menu.remove();
                    }
                }
            ];

            // 添加菜单项到菜单
            menuItems.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'context-menu-item';
                menuItem.innerHTML = `<span class="menu-icon">${item.icon}</span>${item.text}`;
                menuItem.onclick = item.onClick;
                menu.appendChild(menuItem);
            });

            // 调整菜单位置
            menu.style.left = `${e.clientX}px`;
            menu.style.top = `${e.clientY}px`;

            // 添加到文档
            document.body.appendChild(menu);

            // 点击其他地方关闭菜单
            const closeMenu = (e) => {
                if (!menu.contains(e.target)) {
                    menu.remove();
                    document.removeEventListener('click', closeMenu);
                }
            };
            
            setTimeout(() => {
                document.addEventListener('click', closeMenu);
            }, 0);
        }

        // 修改 createButtons 函数
        function createButtons(category) {
            const grid = document.getElementById('buttonGrid');
            if (!grid) {
                console.error('Button grid not found');
                return;
            }
            
            // 清空网格
            grid.innerHTML = '';
            
            // 创建新的空白按钮
            const button = createButton(category, 0);
            grid.appendChild(button);
            
            // 创建添加按钮
            const addButton = document.createElement('button');
            addButton.className = 'add-sound-button';
            addButton.innerHTML = '+';
            addButton.onclick = () => {
                // 创建新的空白按钮
                const newButton = createButton(category, grid.children.length);
                
                // 在"+"按钮之前插入新按钮
                grid.insertBefore(newButton, addButton);
            };
            
            grid.appendChild(addButton);
        }

        async function setupAudioEvents(button, audio) {
            try {
                // 设置音频输出设备
                if (window.selectedAudioOutput && audio.setSinkId) {
                    try {
                        // 使用当前选择的音频输出设备
                        await audio.setSinkId(window.selectedAudioOutput);
                        console.log('Audio output set to:', window.selectedAudioOutput);
                    } catch (err) {
                        console.error('Error setting initial audio output:', err);
                    }
                }

                audio.ontimeupdate = () => {
                    if (audio.duration) {
                        // 更新进度条
                        const progress = (audio.currentTime / audio.duration) * 100;
                        const bottomBar = document.querySelector('.bottom-bar');
                        if (bottomBar) {
                            bottomBar.style.setProperty('--progress', `${progress}%`);
                        }

                        // 更新时间显示
                        const timeDisplay = document.querySelector('.time-display');
                        if (timeDisplay) {
                            const currentTime = formatTime(audio.currentTime);
                            const totalTime = formatTime(audio.duration);
                            timeDisplay.textContent = `${currentTime} / ${totalTime}`;
                        }
                    }
                };
                
                audio.onended = () => {
                    button.classList.remove('playing');
                    const bottomBar = document.querySelector('.bottom-bar');
                    if (bottomBar) {
                        bottomBar.style.setProperty('--progress', '0%');
                    }
                    // 重置时间显示
                    const timeDisplay = document.querySelector('.time-display');
                    if (timeDisplay) {
                        timeDisplay.textContent = '00:00 / 00:00';
                    }
                    // 重置当前播放显示
                    const currentPlayingSpan = document.querySelector('.playback-controls span');
                    if (currentPlayingSpan) {
                        currentPlayingSpan.textContent = '当前播放: 无';
                    }
                };
                
                button.onclick = async () => {
                    try {
                        if (window.currentAudio) {
                            window.currentAudio.pause();
                            window.currentAudio.currentTime = 0;
                            document.querySelectorAll('.sound-button.playing').forEach(btn => {
                                btn.classList.remove('playing');
                            });
                        }

                        // 在播放前确保使用正确的音频输出设备
                        if (window.selectedAudioOutput && audio.setSinkId) {
                            await audio.setSinkId(window.selectedAudioOutput);
                        }
                        
                        audio.currentTime = 0;
                        await audio.play();
                        window.currentAudio = audio;
                        button.classList.add('playing');

                        // 更新当前播放显示
                        const currentPlayingSpan = document.querySelector('.playback-controls span');
                        if (currentPlayingSpan) {
                            currentPlayingSpan.textContent = `当前播放: ${button.audioData.name || '未命名'}`;
                        }
                    } catch (err) {
                        console.error('Error playing audio:', err);
                        showNotification('播放失败，请检查音频设备', 'error');
                    }
                };
            } catch (err) {
                console.error('Error in setupAudioEvents:', err);
                showNotification('音频设置失败', 'error');
            }
        }

        async function saveConfig() {
            try {
                // 先获取已保存的配置
                const savedConfig = await ipcRenderer.invoke('load-config') || { buttons: [] };
                
                // 获取当前分类
                const currentCategory = document.querySelector('.category-tabs .tab-item.active').textContent;
                
                // 移除当前分类的旧数据
                const otherButtons = savedConfig.buttons.filter(btn => btn.category !== currentCategory);
                
                // 获取当前分类的所有按钮（包括空白按钮）
                const currentButtons = [];
                document.querySelectorAll('.sound-button').forEach((button, index) => {
                    // 保存所有按钮，包括没有音频的空白按钮
                    currentButtons.push({
                        category: currentCategory,
                        index: index,
                        id: button.id, // 保存按钮 ID
                        name: button.querySelector('span').textContent || '',
                        audioPath: button.audioData ? button.audioData.path : '',
                        isEmpty: !button.audioData,
                        hotkey: button.getAttribute('data-hotkey') || '' // 添加快捷键字段
                    });
                });
                
                // 合并数据
                const newConfig = {
                    buttons: [...otherButtons, ...currentButtons]
                };
                
                console.log('Saving config with hotkeys:', newConfig);
                await ipcRenderer.invoke('save-config', newConfig);
                
            } catch (err) {
                console.error('Save config error:', err);
            }
        }

        // 添加一个静默设置快捷键的函数
        async function setHotkeyQuietly(button, hotkey) {
            try {
                const electronHotkey = hotkey
                    .replace('Ctrl', 'CommandOrControl')
                    .replace(/\+/g, '+');
                    
                const success = await ipcRenderer.invoke('register-hotkey', {
                    hotkey: electronHotkey,
                    buttonId: button.id
                });

                if (success) {
                    // 不要清除其他按钮的快捷键
                    button.setAttribute('data-hotkey', hotkey);
                    
                    let badge = button.querySelector('.hotkey-badge');
                    if (!badge) {
                        badge = document.createElement('div');
                        badge.className = 'hotkey-badge';
                        button.appendChild(badge);
                    }
                    badge.textContent = hotkey;
                }
            } catch (error) {
                console.error('Error setting hotkey:', error);
            }
        }

        // 相应地修改 loadConfig 函数中的快捷键设置部分
        async function loadConfig(category) {
            try {
                const config = await ipcRenderer.invoke('load-config');
                const grid = document.getElementById('buttonGrid');
                if (!grid) return;
                
                grid.innerHTML = '';
                
                if (config && config.buttons) {
                    // 过滤当前分类的按钮
                    const categoryButtons = config.buttons.filter(btn => btn.category === category);
                    
                    // 创建按钮
                    for (const btnConfig of categoryButtons) {
                        const button = createButton(category);
                        if (btnConfig.audioPath) {
                            // 确保路径是绝对路径
                            const audioPath = path.isAbsolute(btnConfig.audioPath) 
                                ? btnConfig.audioPath 
                                : path.join(await ipcRenderer.invoke('get-app-path'), 'audio', path.basename(btnConfig.audioPath));
                            
                            const audio = new Audio(audioPath);
                            button.audioData = {
                                path: audioPath,
                                name: btnConfig.name,
                                audio: audio
                            };
                            button.querySelector('span').textContent = btnConfig.name;
                            button.classList.add('has-audio');
                            setupAudioEvents(button, audio);
                        }
                        if (btnConfig.hotkey) {
                            button.setAttribute('data-hotkey', btnConfig.hotkey);
                            const badge = document.createElement('div');
                            badge.className = 'hotkey-badge';
                            badge.textContent = btnConfig.hotkey;
                            button.appendChild(badge);
                        }
                        grid.appendChild(button);
                    }
                }
                
                // 添加"+"按钮
                const addButton = document.createElement('button');
                addButton.className = 'add-sound-button';
                addButton.innerHTML = '+';
                addButton.onclick = () => {
                    const newButton = createButton(category, grid.children.length);
                    grid.insertBefore(newButton, addButton);
                };
                grid.appendChild(addButton);
                
            } catch (err) {
                console.error('Load config error:', err);
                showNotification('加载配置失败', 'error');
            }
        }

        // 2. 等待 DOM 加载完成后再执行
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('DOM Content Loaded, initializing...');
            
            // 初始化全局变量
            window.currentAudio = null;
            
            try {
                // 注册所有快捷键
                await registerAllHotkeys();
                console.log('All hotkeys registered');
                
                // 其他初始化代码...
            } catch (error) {
                console.error('Error during initialization:', error);
            }

            // 首先设置窗口控制按钮事件
            const closeButton = document.querySelector('.close-button');
            const minButton = document.querySelector('.min-button');
            
            if (closeButton) {
                closeButton.addEventListener('click', () => {
                    ipcRenderer.send('close-window');  // 直接使用 ipcRenderer
                });
            }
            
            if (minButton) {
                minButton.addEventListener('click', () => {
                    ipcRenderer.send('minimize-window');  // 直接使用 ipcRenderer
                });
            }

            // 初始化事件监听
            document.querySelectorAll('.category-tabs .tab-item').forEach(tab => {
                if (tab.id !== 'editTab') {
                    tab.onclick = async () => {
                        document.querySelectorAll('.category-tabs .tab-item').forEach(t => {
                            t.classList.remove('active');
                        });
                        tab.classList.add('active');
                        
                        await loadConfig(tab.textContent);
                    };
                }
            });

            // 初始化默认分类
            const defaultTab = document.querySelector('.category-tabs .tab-item:not(#editTab)');
            if (defaultTab) {
                defaultTab.click();
            }

            // 移除所有按钮的焦点效果
            document.addEventListener('mousedown', (e) => {
                if (e.target.closest('.sound-button')) {
                    e.preventDefault();
                    e.target.closest('.sound-button').blur();
                }
            });
            
            // 阻止默认的焦点行为
            document.addEventListener('click', (e) => {
                if (e.target.closest('.sound-button')) {
                    e.target.closest('.sound-button').blur();
                }
            });

            // 右键点击其他地方关闭菜单
            document.addEventListener('contextmenu', (e) => {
                if (!e.target.closest('.sound-button')) {
                    const menu = document.querySelector('.context-menu');
                    if (menu) {
                        menu.remove();
                    }
                }
            });

            // 为按钮网格添加拖放功能
            const buttonGrid = document.getElementById('buttonGrid');
            if (buttonGrid) {
                buttonGrid.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    buttonGrid.classList.add('dragover');
                });

                buttonGrid.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    buttonGrid.classList.remove('dragover');
                });

                buttonGrid.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    buttonGrid.classList.remove('dragover');

                    // 确保拖放发生在空白区域而不是按钮上
                    if (e.target === buttonGrid) {
                        const files = Array.from(e.dataTransfer.files).filter(file => 
                            file.type.startsWith('audio/') || file.name.endsWith('.mp3')
                        );

                        if (files.length > 0) {
                            try {
                                // 获取当前分类
                                const currentCategory = document.querySelector('.category-tabs .tab-item.active').textContent;
                                
                                // 移除旧的添加按钮
                                const addButton = buttonGrid.querySelector('.add-sound-button');
                                if (addButton) {
                                    addButton.remove();
                                }

                                // 批量创建按钮
                                for (const file of files) {
                                    // 创建新按钮
                                    const newButton = createButton(currentCategory, buttonGrid.children.length);
                                    const textSpan = newButton.querySelector('span');
                                    textSpan.textContent = file.name.replace('.mp3', '');
                                    
                                    // 设置音频数据
                                    const audio = new Audio(file.path);
                                    newButton.audioData = {
                                        path: file.path,
                                        name: file.name.replace('.mp3', ''),
                                        audio: audio
                                    };
                                    
                                    setupAudioEvents(newButton, audio);
                                    newButton.classList.add('has-audio');
                                    
                                    // 添加新按钮
                                    buttonGrid.appendChild(newButton);
                                }
                                
                                // 重新添加"+"按钮
                                if (addButton) {
                                    buttonGrid.appendChild(addButton);
                                }
                                
                                // 保存配置
                                await saveConfig();

                                // 显示成功通知
                                if (files.length === 1) {
                                    showNotification('音效添加成功！', 'success');
                                } else {
                                    showNotification(`成功添加 ${files.length} 个音效`, 'success');
                                }
                                
                            } catch (err) {
                                console.error('Error adding audio files:', err);
                                showNotification('添加音效失败，请重试', 'error');
                            }
                        } else {
                            showNotification('请拖放音频文件', 'info');
                        }
                    }
                });
            }

            // 添加停止按钮事件监听
            const stopButton = document.querySelector('.stop-button');
            if (stopButton) {
                stopButton.addEventListener('click', () => {
                    if (window.currentAudio) {
                        window.currentAudio.pause();
                        window.currentAudio.currentTime = 0;
                        window.currentAudio = null;

                        // 移除所有按钮的播放状态
                        document.querySelectorAll('.sound-button.playing').forEach(btn => {
                            btn.classList.remove('playing');
                        });

                        // 重置进度条
                        const bottomBar = document.querySelector('.bottom-bar');
                        if (bottomBar) {
                            bottomBar.style.setProperty('--progress', '0%');
                        }

                        // 重置时间显示
                        const timeDisplay = document.querySelector('.time-display');
                        if (timeDisplay) {
                            timeDisplay.textContent = '00:00 / 00:00';
                        }

                        // 重置当前播放显示
                        const currentPlayingSpan = document.querySelector('.playback-controls span');
                        if (currentPlayingSpan) {
                            currentPlayingSpan.textContent = '当前播放: 无';
                        }
                    }
                });
            }
        });

        // 添加快捷键相关函数 - 移到前面来
        function showHotkeyDialog(button) {
            console.log('Showing hotkey dialog...');
            const dialog = document.getElementById('hotkeyDialog');
            if (!dialog) {
                console.error('Dialog element not found!');
                return;
            }
            
            const display = document.getElementById('currentHotkey');
            const confirmBtn = document.getElementById('confirmHotkey');
            const cancelBtn = document.getElementById('cancelHotkey');
            let currentHotkey = '';
            
            dialog.style.display = 'flex';
            display.textContent = '按下按键...';
            
            function handleKeyDown(e) {
                e.preventDefault();
                
                const keys = [];
                if (e.ctrlKey) keys.push('Ctrl');
                if (e.shiftKey) keys.push('Shift');
                if (e.altKey) keys.push('Alt');
                
                if (!['Control', 'Shift', 'Alt'].includes(e.key)) {
                    keys.push(e.key.toUpperCase());
                }
                
                currentHotkey = keys.join('+');
                display.textContent = currentHotkey;
            }
            
            document.addEventListener('keydown', handleKeyDown);
            
            confirmBtn.onclick = () => {
                if (currentHotkey) {
                    setHotkey(button, currentHotkey); // 移除这里的通知，只保留 setHotkey 中的通知
                }
                cleanup();
            };
            
            cancelBtn.onclick = cleanup;
            
            function cleanup() {
                dialog.style.display = 'none';
                document.removeEventListener('keydown', handleKeyDown);
            }
        }

        // 修改 setHotkey 函数
        async function setHotkey(button, hotkey) {
            try {
                // 转换快捷键格式为 Electron 支持的格式
                const electronHotkey = hotkey
                    .replace('Ctrl', 'CommandOrControl')
                    .replace(/\+/g, '+');
                    
                // 注册全局快捷键
                const success = await ipcRenderer.invoke('register-hotkey', {
                    hotkey: electronHotkey,
                    buttonId: button.id
                });

                if (success) {
                    // 移除其他按钮上的相同快捷键
                    document.querySelectorAll('.sound-button').forEach(btn => {
                        if (btn.getAttribute('data-hotkey') === hotkey) {
                            removeHotkey(btn);
                        }
                    });
                    
                    button.setAttribute('data-hotkey', hotkey);
                    
                    // 更新或添加快捷键显示
                    let badge = button.querySelector('.hotkey-badge');
                    if (!badge) {
                        badge = document.createElement('div');
                        badge.className = 'hotkey-badge';
                        button.appendChild(badge);
                    }
                    badge.textContent = hotkey;
                    
                    await saveConfig();
                    showNotification('快捷键设置成功', 'success');
                } else {
                    showNotification('快捷键注册失败，可能已被占用', 'error');
                }
            } catch (error) {
                console.error('Error setting hotkey:', error);
                showNotification('快捷键设置失败', 'error');
            }
        }

        // 修改 removeHotkey 函数
        async function removeHotkey(button) {
            const hotkey = button.getAttribute('data-hotkey');
            if (hotkey) {
                const electronHotkey = hotkey
                    .replace('Ctrl', 'CommandOrControl')
                    .replace(/\+/g, '+');
                    
                await ipcRenderer.invoke('unregister-hotkey', electronHotkey);
            }
            
            button.removeAttribute('data-hotkey');
            const badge = button.querySelector('.hotkey-badge');
            if (badge) {
                badge.remove();
            }
            await saveConfig();
            showNotification('快捷键已清除', 'success');
        }

        // 直接设置为 window 的属性，而不是使用 let 声明
        window.audioControl = null;
        window.debounceControl = null;

        // 等待 DOM 加载完成后初始化
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('DOM Content Loaded, initializing...');
            
            // 初始化全局变量
            window.currentAudio = null;
            
            try {
                // 注册所有快捷键
                await registerAllHotkeys();
                console.log('All hotkeys registered');
                
                // 其他初始化代码...
            } catch (error) {
                console.error('Error during initialization:', error);
            }

            // 初始化音频控制对象
            window.audioControl = {
                currentAudio: null,
                stopAllAudio() {
                    if (this.currentAudio) {
                        this.currentAudio.pause();
                        this.currentAudio.currentTime = 0;
                        this.currentAudio = null;
                    }
                    if (window.currentAudio) {
                        window.currentAudio.pause();
                        window.currentAudio.currentTime = 0;
                        window.currentAudio = null;
                    }
                    document.querySelectorAll('.sound-button.playing').forEach(btn => {
                        btn.classList.remove('playing');
                    });
                },
                play(audioPath) {
                    this.stopAllAudio();
                    const audio = new Audio(audioPath);
                    this.currentAudio = audio;
                    audio.play();
                    audio.onended = () => {
                        if (this.currentAudio === audio) {
                            this.currentAudio = null;
                        }
                    };
                }
            };

            window.debounceControl = {
                lastTriggerTime: {},
                minInterval: 300,
                isAllowed(hotkey) {
                    const now = Date.now();
                    const lastTime = this.lastTriggerTime[hotkey] || 0;
                    if (now - lastTime >= this.minInterval) {
                        this.lastTriggerTime[hotkey] = now;
                        return true;
                    }
                    return false;
                }
            };

            window.currentAudio = null;
            
            // 注册所有快捷键
            await registerAllHotkeys();
            
            // 窗口控制
            const closeButton = document.querySelector('.close-button');
            const minButton = document.querySelector('.min-button');
            
            if (closeButton) {
                closeButton.addEventListener('click', () => {
                    ipcRenderer.send('close-window');
                });
            }
            
            if (minButton) {
                minButton.addEventListener('click', () => {
                    ipcRenderer.send('minimize-window');
                });
            }

            // 初始化默认分类
            const defaultTab = document.querySelector('.category-tabs .tab-item:not(#editTab)');
            if (defaultTab) {
                defaultTab.click();
            }
        });

        // 注册所有快捷键函数
        async function registerAllHotkeys() {
            try {
                console.log('Starting to register all hotkeys...');
                const config = await ipcRenderer.invoke('load-config');
                if (config && config.buttons) {
                    // 先注销所有现有的快捷键
                    await ipcRenderer.invoke('unregister-all-hotkeys');
                    
                    // 重新注册所有快捷键
                    for (const button of config.buttons) {
                        if (button.hotkey) {
                            const electronHotkey = button.hotkey
                                .replace('Ctrl', 'CommandOrControl')
                                .replace(/\+/g, '+');
                                
                            console.log('Registering hotkey:', electronHotkey, 'for button:', button.id);
                            const success = await ipcRenderer.invoke('register-hotkey', {
                                hotkey: electronHotkey,
                                buttonId: button.id
                            });
                            
                            if (success) {
                                console.log('Successfully registered hotkey:', electronHotkey);
                            } else {
                                console.error('Failed to register hotkey:', electronHotkey);
                            }
                        }
                    }
                }
            } catch (err) {
                console.error('Error registering all hotkeys:', err);
            }
        }

        // 修改快捷键触发事件处理
        ipcRenderer.on('hotkey-triggered', async (event, buttonId) => {
            console.log('Hotkey triggered for button:', buttonId);
            
            try {
                const button = document.getElementById(buttonId);
                if (button && button.audioData && button.audioData.audio) {
                    // 直接触发按钮的点击事件，这样会使用已经设置好的 audio 对象
                    button.click();
                } else {
                    // 如果按钮不在当前视图中，从配置中查找
                    const config = await ipcRenderer.invoke('load-config');
                    if (config && config.buttons) {
                        const buttonConfig = config.buttons.find(btn => btn.id === buttonId);
                        if (buttonConfig && buttonConfig.audioPath) {
                            // 创建新的音频对象并设置正确的输出设备
                            const audio = new Audio(buttonConfig.audioPath);
                            
                            // 在播放前设置输出设备
                            if (window.selectedAudioOutput && audio.setSinkId) {
                                await audio.setSinkId(window.selectedAudioOutput);
                            }

                            if (window.currentAudio) {
                                window.currentAudio.pause();
                                window.currentAudio.currentTime = 0;
                            }
                            
                            await audio.play();
                            window.currentAudio = audio;

                            // 更新当前播放显示
                            const currentPlayingSpan = document.querySelector('.playback-controls span');
                            if (currentPlayingSpan) {
                                currentPlayingSpan.textContent = `当前播放: ${buttonConfig.name || '未命名'}`;
                            }

                            // 设置音频结束事件
                            audio.onended = () => {
                                // 重置当前播放显示
                                if (currentPlayingSpan) {
                                    currentPlayingSpan.textContent = '当前播放: 无';
                                }
                            };
                        }
                    }
                }
            } catch (error) {
                console.error('Error handling hotkey:', error);
            }
        });

        // 在 DOMContentLoaded 事件中注册快捷键
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('Initializing hotkeys...');
                await registerAllHotkeys();
                console.log('Hotkeys initialized');
            } catch (error) {
                console.error('Error initializing hotkeys:', error);
            }
        });

        // 处理设置项变化
        document.getElementById('showProgress').addEventListener('change', (e) => {
            const bottomBar = document.querySelector('.bottom-bar');
            if (bottomBar) {
                bottomBar.style.setProperty('--progress-visible', e.target.checked ? '1' : '0');
            }
        });

        document.getElementById('themeColor').addEventListener('change', (e) => {
            document.documentElement.style.setProperty('--theme-color', e.target.value);
        });

        // 在播放音效前检查酷狗状态
        async function handleAudioPlay(audio) {
            console.log('Audio play triggered');
            
            try {
                const isKugouPlaying = await window.electronAPI.checkKugouStatus();
                console.log('Kugou status check result:', isKugouPlaying);
                
                if (isKugouPlaying) {
                    console.log('Kugou is playing, attempting to control...');
                    const controlType = localStorage.getItem('audioControl') || 'none';
                    console.log('Control type:', controlType);
                    
                    if (controlType !== 'none' && window.electronAPI) {
                        console.log('Sending control command...');
                        window.electronAPI.controlAudio(controlType);
                    }
                } else {
                    console.log('Kugou is not playing or not found');
                }
            } catch (error) {
                console.error('Error checking Kugou status:', error);
            }
        }

        // 确保音频事件监听器被正确添加
        function setupAudioControls(audio) {
            console.log('Setting up audio controls');
            audio.addEventListener('play', () => {
                console.log('Audio play event triggered');
                handleAudioPlay(audio);
            });
        }

        // 测试函数
        async function testKugouStatus() {
            console.log('Testing Kugou status...');
            const status = await window.electronAPI.checkKugouStatus();
            console.log('Kugou status:', status);
        }

        // 添加测试按钮到设置页面
        document.querySelector('.settings-group').insertAdjacentHTML('beforeend', `
            <div class="settings-item">
                <button onclick="testKugouStatus()">测试酷狗状态</button>
            </div>
        `);

        // 添加测试按钮的点击事件
        document.getElementById('testKugou')?.addEventListener('click', async () => {
            console.log('Testing Kugou status...');
            const status = await window.electronAPI.checkKugouStatus();
            console.log('Kugou status:', status);
            alert('酷狗状态: ' + (status ? '正在播放' : '未播放'));
        });

        // 添加通知系统
        function showNotification(message, type = 'info', duration = 2000) {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            requestAnimationFrame(() => {
                notification.classList.add('show');
            });
            
            setTimeout(() => {
                notification.classList.add('hide');
                notification.addEventListener('animationend', () => {
                    notification.remove();
                });
            }, duration);
        }

        // 添加快捷键相关函数
        function showHotkeyDialog(button) {
            console.log('Showing hotkey dialog...');
            const dialog = document.getElementById('hotkeyDialog');
            if (!dialog) {
                console.error('Dialog element not found!');
                return;
            }
            
            const display = document.getElementById('currentHotkey');
            const confirmBtn = document.getElementById('confirmHotkey');
            const cancelBtn = document.getElementById('cancelHotkey');
            let currentHotkey = '';
            
            dialog.style.display = 'flex';
            display.textContent = '按下按键...';
            
            function handleKeyDown(e) {
                e.preventDefault();
                
                const keys = [];
                if (e.ctrlKey) keys.push('Ctrl');
                if (e.shiftKey) keys.push('Shift');
                if (e.altKey) keys.push('Alt');
                
                if (!['Control', 'Shift', 'Alt'].includes(e.key)) {
                    keys.push(e.key.toUpperCase());
                }
                
                currentHotkey = keys.join('+');
                display.textContent = currentHotkey;
            }
            
            document.addEventListener('keydown', handleKeyDown);
            
            confirmBtn.onclick = () => {
                if (currentHotkey) {
                    setHotkey(button, currentHotkey); // 移除这里的通知，只保留 setHotkey 中的通知
                }
                cleanup();
            };
            
            cancelBtn.onclick = cleanup;
            
            function cleanup() {
                dialog.style.display = 'none';
                document.removeEventListener('keydown', handleKeyDown);
            }
        }

        // 修改 setHotkey 函数
        async function setHotkey(button, hotkey) {
            try {
                // 转换快捷键格式为 Electron 支持的格式
                const electronHotkey = hotkey
                    .replace('Ctrl', 'CommandOrControl')
                    .replace(/\+/g, '+');
                    
                // 注册全局快捷键
                const success = await ipcRenderer.invoke('register-hotkey', {
                    hotkey: electronHotkey,
                    buttonId: button.id
                });

                if (success) {
                    // 移除其他按钮上的相同快捷键
                    document.querySelectorAll('.sound-button').forEach(btn => {
                        if (btn.getAttribute('data-hotkey') === hotkey) {
                            removeHotkey(btn);
                        }
                    });
                    
                    button.setAttribute('data-hotkey', hotkey);
                    
                    // 更新或添加快捷键显示
                    let badge = button.querySelector('.hotkey-badge');
                    if (!badge) {
                        badge = document.createElement('div');
                        badge.className = 'hotkey-badge';
                        button.appendChild(badge);
                    }
                    badge.textContent = hotkey;
                    
                    await saveConfig();
                    showNotification('全局快捷键设置成功', 'success');
                } else {
                    showNotification('快捷键注册失败，可能已被占用', 'error');
                }
            } catch (error) {
                console.error('Error setting hotkey:', error);
                showNotification('快捷键设置失败', 'error');
            }
        }

        // 修改 removeHotkey 函数
        async function removeHotkey(button) {
            const hotkey = button.getAttribute('data-hotkey');
            if (hotkey) {
                const electronHotkey = hotkey
                    .replace('Ctrl', 'CommandOrControl')
                    .replace(/\+/g, '+');
                    
                await ipcRenderer.invoke('unregister-hotkey', electronHotkey);
            }
            
            button.removeAttribute('data-hotkey');
            const badge = button.querySelector('.hotkey-badge');
            if (badge) {
                badge.remove();
            }
            await saveConfig();
            showNotification('快捷键已清除', 'success');
        }

        // 在现有的 DOMContentLoaded 事件监听器中添加
        document.addEventListener('DOMContentLoaded', async () => {
            // ... 其他初始化代码 ...
            
            // 初始化音频输出设备选择
            await initAudioOutputs();
        });

        // 添加时间格式化函数
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
    </script>
    <style>
@layer base {
    .sound-button {
        -webkit-tap-highlight-color: transparent !important;
        -webkit-user-drag: none;
        -webkit-user-select: none;
        user-select: none;
    }

    .sound-button::after {
        display: none !important;
    }

    .sound-button::before {
        -webkit-user-drag: none;
        user-select: none;
    }
}

        :root {
            --base-size: min(2vh, 16px);
            --padding: calc(var(--base-size) * 1.5);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: system-ui;
            background: transparent !important;
        }

        .app-container {
            width: 100%;
            height: 100vh;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2),  /* 主阴影 */
                        0 8px 24px rgba(0, 0, 0, 0.15),  /* 中等范围阴影 */
                        0 16px 48px rgba(0, 0, 0, 0.1);  /* 大范围柔和阴影 */
        }

        /* 标题栏样式 */
        .title-bar {
            -webkit-app-region: drag;
            height: 45px;  /* 标准高度 */
            background: #3498ff !important;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            color: white;
        }

        /* 左侧菜单 */
        .left-menu {
            width: 60px;
            background: #f8f9fa;
            border-right: 1px solid #eaeaea;
            display: flex;
            flex-direction: column;
        }

        .menu-item {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #666;
        }

        .menu-item:hover {
            background: #e9ecef;
        }

        /* 主内容区 */
        .main-content {
            flex: 1;
            display: flex;
            min-height: 0; /* 防止内容溢出 */
        }

        /* 分类标签栏 */
        .category-tabs {
            height: 48px;
            background: #ffffff;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 8px;
            border-bottom: 1px solid #eaeaea;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
            user-select: none; /* 防止拖动时选中文字 */
        }

        .category-tabs::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        /* 分类标签基础样式 */
        .tab-item {
            position: relative;
            display: inline-flex !important;
            align-items: center;
            padding: 6px 12px !important;
            border-radius: 20px;
            background: #fff;
            border: none;
            margin: 0 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-bottom: none !important;
        }

        /* 分类名称样式 */
        .category-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
            max-width: calc(100% - 45px); /* 为操作按钮预留空间 */
        }

        /* 操作按钮容器 */
        .action-buttons {
            display: none;
            align-items: center;
            gap: 2px;
            margin-left: 4px;
        }

        .tab-item.edit-mode .action-buttons {
            display: inline-flex;
        }

        /* 编辑和删除按钮 */
        .edit-btn, .delete-btn {
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s ease;
            font-size: 12px;
        }

        .edit-btn {
            color: #2196F3;
        }

        .delete-btn {
            color: #ff4444;
        }

        .edit-btn:hover, .delete-btn:hover {
            opacity: 1;
        }

        .tab-item:hover {
            border-bottom: none !important;
        }

        .tab-item.active {
            border-bottom: none !important;
        }

        .tab-item.active:hover {
            border-bottom: none !important;
        }

        .tab-item.dragging {
            opacity: 0.5;
            background: #e3f2fd;
        }

        /* 编辑按钮特殊样式 */
        #editTab {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px dashed #4caf50;
        }

        #editTab:hover {
            background: #c8e6c9;
            border-style: solid;
        }

        /* 创建分类对话框样式 */
        #createCategoryDialog {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            min-width: 300px;
        }

        #createCategoryDialog h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 18px;
            font-weight: 500;
        }

        #newCategoryInput {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        #newCategoryInput:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .dialog-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        #cancelCreate, #confirmCreate {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        #cancelCreate {
            background: #f5f5f5;
            color: #666;
        }

        #cancelCreate:hover {
            background: #e0e0e0;
        }

        #confirmCreate {
            background: #2196F3;
            color: white;
        }

        #confirmCreate:hover {
            background: #1976D2;
            box-shadow: 0 2px 4px rgba(33, 150, 243, 0.2);
        }

        /* 添加遮罩层 */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000; /* 确保比其他元素都高 */
            backdrop-filter: blur(4px);
        }

        .dialog-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            min-width: 300px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .dialog-content h3 {
            margin: 0 0 8px 0;
            color: #333;
        }

        .dialog-content p {
            margin: 0 0 16px 0;
            color: #666;
            font-size: 14px;
        }

        .hotkey-display {
            margin: 20px 0;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            font-size: 16px;
            min-height: 20px;
            background: #f5f5f5;
        }

        .dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
        }

        .dialog-buttons button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        #cancelHotkey {
            background: #f5f5f5;
            color: #333;
        }

        #confirmHotkey {
            background: #2196f3;
            color: white;
        }

        #cancelHotkey:hover {
            background: #e0e0e0;
        }

        #confirmHotkey:hover {
            background: #1976d2;
        }

        /* 按钮上的快捷键显示 */
        .hotkey-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
        }

        /* 按钮网格样式 */
        .button-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            min-height: 0;
            grid-auto-rows: min-content;
            align-content: start;
        }

        /* 按钮样式优化 */
        .sound-button {
            height: 56px;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: var(--base-size);
            user-select: none;
            position: relative;
            outline: none;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* 内容区域 */
        .sound-button span {
            color: #333;
            padding: 0 16px;
            text-align: center;
            font-weight: 500;
        }

        /* 悬停效果 */
        .sound-button:hover {
            background: #f8f9fa;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }

        /* 点击效果 */
        .sound-button:active {
            transform: translateY(0);
            background: #f1f3f5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* 播放中的按钮样式 */
        .sound-button.playing {
            background: #e3f2fd;
            border-color: #2196F3;
            color: #1976D2;
        }

        /* 已有音频的按钮样式 */
        .sound-button.has-audio {
            background: #fff;
            border-color: #2196F3;
            color: #1976D2;
        }

        /* 移除所有状态的效果 */
        .sound-button:focus,
        .sound-button:active,
        .sound-button:hover,
        .sound-button *:focus,
        .sound-button *:active,
        .sound-button *:hover {
            outline: none !important;
            -webkit-tap-highlight-color: transparent;
        }

        /* 底部控制栏 */
        .bottom-bar {
            height: 45px;
            background: #3498ff !important;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 15px;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
            opacity: 1 !important;
            flex-shrink: 0; /* 防止底部栏被压缩 */
        }

        /* 修改底部进度条颜色，使其与新的蓝色搭配 */
        .bottom-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: var(--progress, 0%);
            height: 3px;
            background: rgba(255, 255, 255, 0.9) !important;
            transition: width 0.1s linear;
        }

        /* 修改底部进度条动画颜色 */
        .bottom-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: var(--progress, 0%);
            height: 3px;
            background: linear-gradient(
                90deg,
                #3498ff,
                #ffffff,
                #3498ff
            );
            animation: slide 1.5s linear infinite;
        }

        @keyframes slide {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        /* 播放控制区域样式 */
        .playback-controls {
            display: flex;
            align-items: center;
            justify-content: space-between; /* 两端对齐 */
            width: 100%;
            height: 100%;
            padding: 0 15px;
        }

        /* 左侧播放信息 */
        .playback-info {
            flex: 0 1 auto;
        }

        .playback-info span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px;
            color: white;
            font-size: 12px; /* 和时间显示一样的字体大小 */
            font-family: monospace; /* 可选：使用等宽字体，和时间显示保持一致 */
        }

        /* 右侧控制元素容器 */
        .control-elements {
            display: flex;
            align-items: center;
            gap: 20px; /* 控制元素之间的间距 */
            margin-left: auto; /* 推到右边 */
        }

        /* 停止按钮 */
        .stop-button {
            padding: 4px 12px;
            height: 24px;
            line-height: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
        }

        /* 时间显示 */
        .time-display {
            font-family: monospace;
            font-size: 12px;
            color: white;
            min-width: 90px;
            text-align: center;
        }

        /* 音频输出控制 */
        .audio-output-control {
            min-width: 150px;
        }

        .audio-output-select {
            width: 100%;
            padding: 4px 8px;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            color: white;
            font-size: 12px;
            cursor: pointer;
        }

        .channel-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 2px 5px; /* 减小内边距 */
            border-radius: 3px; /* 减小圆角 */
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px; /* 减小字体大小 */
            height: 24px; /* 适当增加高度 */
            line-height: 24px; /* 文字垂直居中 */
        }

        .channel-select:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* 窗口控制按钮样式优化 */
        .window-controls {
            -webkit-app-region: no-drag;
        }

        .window-controls button {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px 10px;
            transition: all 0.2s ease;
            border-radius: 4px;
        }

        .window-controls button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .window-controls button:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.2);
        }

        /* 编辑模式的晃动动画 */
        @keyframes wiggle {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-1deg); }
            75% { transform: rotate(1deg); }
            100% { transform: rotate(0deg); }
        }

        /* 编辑模式的标签样式 */
        .tab-item.edit-mode {
            animation: wiggle 0.6s infinite;
            cursor: move;
            padding-left: 24px; /* 为删除按钮留出空间 */
            position: relative;
        }

        /* 删除按钮样式 */
        .delete-badge {
            position: absolute;
            left: 4px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background: #ff4444;
            border-radius: 50%;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            z-index: 1;
        }

        .tab-item.edit-mode .delete-badge {
            display: flex;
        }

        /* 编辑按钮激活状态 */
        #editTab.active {
            background: #4caf50;
            color: white;
            border: none;
        }

        /* 编辑模式样式 */
        .tab-item.edit-mode {
            animation: wiggle 0.6s infinite;
            cursor: move;
            padding-left: 24px;
        }

        @keyframes wiggle {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-1deg); }
            75% { transform: rotate(1deg); }
            100% { transform: rotate(0deg); }
        }

        /* 添加分类按钮样式优化 */
        .add-category {
            background: #e8f5e9 !important;
            color: #4caf50 !important;
            font-size: 20px !important;
            width: 32px;
            height: 32px;
            padding: 0 !important;
            display: flex !important;
            align-items: center;
            justify-content: center;
            border-radius: 16px !important;
            margin-left: 8px !important;
            animation: none !important; /* 防止继承编辑模式的晃动效果 */
            cursor: pointer !important;
        }

        .add-category:hover {
            background: #c8e6c9 !important;
            transform: scale(1.1);
        }

        /* 编辑模式样式 */
        .tab-item.edit-mode {
            animation: wiggle 0.6s infinite;
            cursor: move;
            padding-left: 24px;
            position: relative;
        }

        /* 默认分类特殊样式 */
        .tab-item.edit-mode.default-category {
            padding-left: 12px; /* 默认分类不需要删除按钮的空间 */
        }

        @keyframes wiggle {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-1deg); }
            75% { transform: rotate(1deg); }
            100% { transform: rotate(0deg); }
        }

        /* 删除按钮样式 */
        .delete-badge {
            position: absolute;
            left: 4px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background: #ff4444;
            border-radius: 50%;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            z-index: 1;
        }

        .tab-item.edit-mode:not(.default-category) .delete-badge {
            display: flex;
        }

        #editTab.active {
            background: #4caf50;
            color: white;
        }

        /* 编辑图标样式优化 */
        .edit-icon {
            position: absolute;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background: #2196F3;
            border-radius: 50%;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            font-size: 12px;
            border: 1.5px solid white;
        }

        /* 添加提示文字 */
        .edit-icon:hover::after {
            content: '修改名称';
            position: absolute;
            top: -25px;
            right: -10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }

        .edit-icon:hover {
            transform: translateY(-50%) scale(1.1);
            background: #1976D2;
        }

        .tab-item.edit-mode .edit-icon {
            display: flex;
        }

        /* 删除图标样式（仅用于用户创建的分类） */
        .delete-badge {
            position: absolute;
            left: -5px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background: #ff4444;
            border-radius: 50%;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            font-size: 12px;
            border: 1.5px solid white;
        }

        /* 编辑状态下的分类标签样式 */
        .tab-item.edit-mode {
            position: relative;
            padding-right: 25px !important; /* 为编辑图标留出空间 */
        }

        /* 用户创建的分类在编辑模式下的样式 */
        .tab-item.edit-mode.user-category {
            padding-left: 25px !important; /* 为删除图标留出空间 */
        }

        .tab-item.edit-mode.user-category .delete-badge {
            display: flex;
        }

        /* 添加删除提示文字 */
        .delete-badge:hover::after {
            content: '删除分类';
            position: absolute;
            top: 24px;
            left: -10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }

        .delete-badge:hover {
            transform: scale(1.1);
            background: #ff1744;
        }

        .tab-item.edit-mode .delete-badge {
            display: flex;
        }

        /* 编辑状态下的分类标签样式 */
        .tab-item.edit-mode {
            position: relative;
            animation: wiggle 1s infinite;
            transform-origin: center center;
        }

        @keyframes wiggle {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-1deg); }
            75% { transform: rotate(1deg); }
            100% { transform: rotate(0deg); }
        }

        /* 编辑按钮激活状态 */
        #editTab.active {
            background: #4caf50;
            color: white;
            position: relative;
        }

        /* 添加编辑模式提示 */
        #editTab.active::after {
            content: '点击退出编辑模式';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
        }

        #editTab:not(.active)::after {
            content: '点击编辑分类';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        #editTab:not(.active):hover::after {
            opacity: 1;
        }

        /* 重命名对话框样式 */
        .rename-dialog {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.12);
            width: 320px;
            position: relative;
        }

        .rename-dialog h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 16px;
            font-weight: 500;
        }

        .rename-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
            box-sizing: border-box;
            transition: all 0.2s ease;
            background: #f5f5f5;
        }

        .rename-input:focus {
            outline: none;
            border-color: #2196F3;
            background: white;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .dialog-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .dialog-button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dialog-button.cancel {
            background: #f5f5f5;
            color: #666;
        }

        .dialog-button.cancel:hover {
            background: #eeeeee;
        }

        .dialog-button.confirm {
            background: #2196F3;
            color: white;
        }

        .dialog-button.confirm:hover {
            background: #1976D2;
        }

        /* 遮罩层样式 */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(2px);
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .rename-dialog {
            animation: slideIn 0.2s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* 编辑模式下的分类标签基础样式 */
        .tab-item.edit-mode {
            position: relative;
            padding: 6px 12px !important;
        }

        /* 编辑图标样式优化 */
        .edit-icon {
            position: absolute;
            right: -4px;
            top: -4px;
            width: 14px;
            height: 14px;
            background: #2196F3;
            border-radius: 50%;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            font-size: 10px;
            border: 1.5px solid white;
            z-index: 2;
        }

        /* 删除图标样式优化 */
        .delete-badge {
            position: absolute;
            right: -4px;
            top: -4px;
            width: 14px;
            height: 14px;
            background: #ff4444;
            border-radius: 50%;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            font-size: 10px;
            border: 1.5px solid white;
            z-index: 2;
        }

        /* 编辑图标位置调整（用于默认分类） */
        .tab-item.edit-mode:not(.user-category) .edit-icon {
            display: flex;
        }

        /* 用户创建的分类特殊处理 */
        .tab-item.edit-mode.user-category .edit-icon {
            right: 12px;
            display: flex;
        }

        .tab-item.edit-mode.user-category .delete-badge {
            display: flex;
        }

        /* 悬停效果 */
        .edit-icon:hover, .delete-badge:hover {
            transform: scale(1.2);
        }

        /* 提示文字样式 */
        .edit-icon:hover::after, .delete-badge:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 10px;
            white-space: nowrap;
            pointer-events: none;
        }

        /* 编辑模式下的分类标签样式 */
        .tab-item {
            position: relative;
            transition: all 0.3s ease;
        }

        .tab-item.edit-mode {
            padding-right: 28px !important;
            background: linear-gradient(to right, transparent 80%, rgba(0,0,0,0.05));
        }

        /* 操作按钮容器 */
        .action-buttons {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            display: none;
            gap: 6px;
            align-items: center;
        }

        .tab-item.edit-mode .action-buttons {
            display: flex;
        }

        /* 编辑和删除按钮 */
        .edit-btn, .delete-btn {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s ease;
            color: #666;
            font-size: 14px;
        }

        .edit-btn:hover, .delete-btn:hover {
            opacity: 1;
            color: #333;
        }

        .delete-btn {
            color: #ff4444;
        }

        .delete-btn:hover {
            color: #ff1744;
        }

        /* 激活状态 */
        .tab-item.active {
            background: #2196F3;
            color: white;
        }

        .tab-item.active .edit-btn,
        .tab-item.active .delete-btn {
            color: white;
        }

        /* 重置所有可能的边框样式 */
        #editTab,
        #editTab *,
        button#editTab,
        button#editTab *,
        .tab-item#editTab,
        .tab-item#editTab * {
            border: 0 !important;
            border-bottom: 0 !important;
            border-width: 0 !important;
            outline: none !important;
            box-shadow: none !important;
            text-decoration: none !important;
        }

        /* 处理所有状态 */
        #editTab:hover,
        #editTab:focus,
        #editTab:active,
        #editTab.active,
        button#editTab:hover,
        button#editTab:focus,
        button#editTab:active,
        button#editTab.active,
        .tab-item#editTab:hover,
        .tab-item#editTab:focus,
        .tab-item#editTab:active,
        .tab-item#editTab.active {
            border: 0 !important;
            border-bottom: 0 !important;
            border-width: 0 !important;
            outline: none !important;
            box-shadow: none !important;
            text-decoration: none !important;
        }

        /* 覆盖任何可能的伪元素 */
        #editTab::before,
        #editTab::after,
        button#editTab::before,
        button#editTab::after,
        .tab-item#editTab::before,
        .tab-item#editTab::after {
            border: 0 !important;
            border-bottom: 0 !important;
            border-width: 0 !important;
            outline: none !important;
            box-shadow: none !important;
            content: none !important;
        }

        /* 添加这些CSS样式 */
        .tab-item {
            position: relative !important;
        }

        .action-buttons {
            position: absolute !important;
            right: 8px !important;
            top: 50% !important;
            transform: translateY(-50%) !important;
            z-index: 999 !important;
            pointer-events: auto !important;
        }

        .edit-btn, .delete-btn {
            position: relative !important;
            z-index: 1000 !important;
            pointer-events: auto !important;
        }

        /* 移除所有可能的焦点样式 */
        .sound-button:focus,
        .sound-button:active,
        .sound-button span:focus,
        .sound-button span:active {
            outline: none;
            box-shadow: none;
        }

        /* 添加底部播放控制栏的样式 */
        .player-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: #2196F3;
            display: flex;
            align-items: center;
            padding: 0 10px;
            z-index: 1000;
        }

        /* 进度条效果 */
        .player-controls::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: var(--progress, 0%);
            background: rgba(255, 255, 255, 0.1);
            transition: width 0.1s linear;
        }

        /* 底部播放控制区域 */
        #footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: #2196F3;
            display: flex;
            align-items: center;
            padding: 0 10px;
            color: white;
        }

        /* 进度条效果 */
        #footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: var(--progress, 0%);
            background: rgba(255, 255, 255, 0.1);
            z-index: 0;
        }

        /* 确保内容在进度条上层 */
        #footer > * {
            position: relative;
            z-index: 1;
        }

        /* 底部状态栏进度条 */
        .status-bar {
            position: relative;
            background: #2196F3;
        }

        .status-bar::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: var(--progress, 0%);
            height: 2px;  /* 进度条高度 */
            background: rgba(255, 255, 255, 0.8);  /* 白色进度条 */
            transition: width 0.1s linear;
        }

        /* 美化滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;  /* 滚动条宽度 */
            height: 8px; /* 横向滚动条高度 */
        }

        /* 滚动条轨道 */
        ::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 4px;
        }

        /* 滚动条滑块 */
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        /* 滚动条滑块悬停效果 */
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* 滚动条滑块激活效果 */
        ::-webkit-scrollbar-thumb:active {
            background: rgba(0, 0, 0, 0.4);
        }

        /* 滚动条角落 */
        ::-webkit-scrollbar-corner {
            background: transparent;
        }

        /* 确保按钮网格区域的滚动条样式一致 */
        .button-grid::-webkit-scrollbar {
            width: 8px;
        }

        .button-grid::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 4px;
        }

        .button-grid::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .button-grid::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* 添加按钮样式 */
        .add-sound-button {
            width: 100%;
            height: 56px;
            background: #f8f9fa;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 32px; /* 增大加号大小 */
            color: #999;
            transition: all 0.2s ease;
            grid-column: span 1; /* 确保按钮占据一个网格单元格 */
        }

        .add-sound-button:hover {
            background: #fff;
            border-color: #3498ff;
            color: #3498ff;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(52, 152, 255, 0.1);
        }

        .add-sound-button:active {
            transform: translateY(0);
        }

        /* 空白按钮样式 */
        .sound-button:not(.has-audio) {
            border: 1px solid #e0e0e0;
            background: #f8f9fa;
        }

        .sound-button:not(.has-audio):hover {
            border-color: #3498ff;
            background: #fff;
        }

        /* 右键菜单样式 */
        .context-menu {
            position: fixed;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 8px;
            padding: 4px;
            min-width: 160px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #333;
            transition: all 0.2s ease;
            border-radius: 4px;
            font-size: 13px;
        }

        .context-menu-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .menu-icon {
            font-size: 16px;
            opacity: 0.8;
        }

        /* 删除相关的菜单项特殊样式 */
        .context-menu-item:nth-child(3),
        .context-menu-item:nth-child(4) {
            color: #e53935;
        }

        .context-menu-item:nth-child(3):hover,
        .context-menu-item:nth-child(4):hover {
            background: rgba(229, 57, 53, 0.1);
        }

        /* 按钮拖放样式 */
        .sound-button {
            position: relative;
            overflow: hidden;
        }

        /* 按钮拖放提示遮罩层 */
        .sound-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(52, 152, 255, 0);
            border: 2px dashed transparent;
            border-radius: 8px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 1;
        }

        /* 按钮拖放提示文字 */
        .sound-button::before {
            content: '替换此按钮的音效';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #3498ff;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            z-index: 2;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* 按钮拖放悬停状态 */
        .sound-button.dragover::after {
            opacity: 1;
            background: rgba(52, 152, 255, 0.1);
            border-color: #3498ff;
        }

        .sound-button.dragover::before {
            opacity: 1;
        }

        .sound-button.dragover span {
            opacity: 0.3;
        }

        /* 网格区域拖放样式 */
        .button-grid {
            position: relative;
        }

        .button-grid::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(76, 175, 80, 0);
            border: 3px dashed transparent;
            border-radius: 8px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 1;
        }

        .button-grid::before {
            content: '拖放到此处创建新按钮';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #4caf50;
            font-size: 18px;
            font-weight: 500;
            white-space: nowrap;
            z-index: 2;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 16px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .button-grid.dragover::after {
            opacity: 1;
            background: rgba(76, 175, 80, 0.1);
            border-color: #4caf50;
        }

        .button-grid.dragover::before {
            opacity: 1;
        }

        /* 通知系统样式 */
        .notification-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            pointer-events: none;
        }

        .notification {
            min-width: 200px;
            max-width: 240px;
            padding: 10px 16px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.65); /* 降低背景透明度 */
            backdrop-filter: blur(12px); /* 增加模糊效果 */
            color: rgba(255, 255, 255, 0.95); /* 稍微柔和的文字颜色 */
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transform: translateY(-20px) scale(0.95);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* 更柔和的阴影 */
            border: 1px solid rgba(255, 255, 255, 0.1); /* 添加微妙的边框 */
        }

        .notification::before {
            content: '';
            width: 16px; /* 减小图标大小 */
            height: 16px;
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
            flex-shrink: 0; /* 防止图标被压缩 */
        }

        .notification.success::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='rgba(76, 175, 80, 0.9)'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z'/%3E%3C/svg%3E");
        }

        .notification.error::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='rgba(244, 67, 54, 0.9)'%3E%3Cpath d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z'/%3E%3C/svg%3E");
        }

        .notification.info::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='rgba(33, 150, 243, 0.9)'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z'/%3E%3C/svg%3E");
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* 添加动画效果 */
        @keyframes notification-in {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes notification-out {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
        }

        .notification.show {
            animation: notification-in 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .notification.hide {
            animation: notification-out 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 在已有的样式中添加 */
        .audio-output-control {
            display: flex;
            align-items: center;
            margin-left: 15px;
        }

        .audio-output-select {
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background: #fff;
            font-size: 12px;
            color: #333;
            cursor: pointer;
            outline: none;
            min-width: 150px;
        }

        .audio-output-select:hover {
            border-color: #999;
        }

        .audio-output-select:focus {
            border-color: #3498ff;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="title-bar">
            <span>音效按钮</span>
            <div class="window-controls">
                <button class="min-button">─</button>
                <button class="close-button">×</button>
            </div>
        </div>

        <div class="main-content">
            <div class="left-menu">
                <div class="menu-item">声音</div>
                <div class="menu-item">信息</div>
                <div class="menu-item">扫描</div>
                <div class="menu-item">注释</div>
                <div class="menu-item">自动</div>
                <div class="menu-item">设置</div>
            </div>

            <div style="flex: 1; display: flex; flex-direction: column;">
                <div class="category-tabs">
                    <!-- 删除编辑按钮 -->
                    <!-- <button class="tab-item" id="editTab">编辑</button> -->
                    <button class="tab-item active">主持</button>
                    <button class="tab-item">喊麦</button>
                    <button class="tab-item">搞笑</button>
                    <button class="tab-item">游戏</button>
                    <button class="tab-item">生活</button>
                    <button class="tab-item">DIY</button>
                </div>

                <div class="button-grid" id="buttonGrid"></div>
            </div>
        </div>

        <div class="bottom-bar">
            <div class="playback-controls">
                <!-- 左侧播放信息 -->
                <div class="playback-info">
                    <span>当前播放: 无</span>
                </div>
                
                <!-- 右侧控制元素 -->
                <div class="control-elements">
                    <button class="stop-button">停止</button>
                    <div class="time-display">00:00 / 00:00</div>
                    <div class="audio-output-control">
                        <select id="audioOutput" class="audio-output-select">
                            <option value="">正在加载音频设备...</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dialog-overlay" id="dialogOverlay" style="display: none;">
        <div id="createCategoryDialog">
            <h3>创建新分类</h3>
            <input type="text" id="newCategoryInput" placeholder="请输入分类名称" maxlength="10">
            <div class="dialog-buttons">
                <button id="cancelCreate">取消</button>
                <button id="confirmCreate">创建</button>
            </div>
        </div>
    </div>

    <div class="settings-container" style="display: none;">
        <div class="settings-group">
            <div class="settings-title">播放设置</div>
            <div class="settings-item">
                <label>外部音乐控制</label>
                <select id="audioControl">
                    <option value="none">不控制</option>
                    <option value="pause">暂停外部音乐</option>
                    <option value="lower">降低外部音乐音量</option>
                </select>
            </div>
            <!-- 添加测试按钮 -->
            <div class="settings-item" style="margin-top: 10px;">
                <button id="testKugou" style="padding: 8px 16px; cursor: pointer;">
                    测试酷狗状态
                </button>
            </div>
        </div>
    </div>

    <!-- 添加通知容器 -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- 添加快捷键设置对话框 -->
    <div id="hotkeyDialog" class="dialog-overlay" style="display: none;">
        <div class="dialog-content">
            <h3>设置快捷键</h3>
            <p>请按下想要设置的按键组合</p>
            <div id="currentHotkey" class="hotkey-display">按下按键...</div>
            <div class="dialog-buttons">
                <button id="cancelHotkey">取消</button>
                <button id="confirmHotkey">确定</button>
            </div>
        </div>
    </div>

    <script>
        // 删除这行，因为已经在其他地方声明过了
        // const ipcRenderer = window.electron.ipcRenderer;

        // 初始化全局变量
        window.currentAudio = null;
        window.selectedAudioOutput = 'default';

        // 音频控制对象
        window.audioControl = {
            currentAudio: null,
            stopAllAudio() {
                // ... 保持现有代码
            }
        };

        // 防抖控制对象
        window.debounceControl = {
            // ... 保持现有代码
        };
    </script>
</body>
</html> 
